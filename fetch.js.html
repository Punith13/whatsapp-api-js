<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>fetch.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ActionButtons.html">ActionButtons</a></li><li><a href="ActionCatalog.html">ActionCatalog</a></li><li><a href="ActionList.html">ActionList</a></li><li><a href="Address.html">Address</a></li><li><a href="Audio.html">Audio</a></li><li><a href="Birthday.html">Birthday</a></li><li><a href="Body.html">Body</a></li><li><a href="BodyComponent.html">BodyComponent</a></li><li><a href="Button.html">Button</a></li><li><a href="ButtonComponent.html">ButtonComponent</a><ul class='methods'><li data-type='method'><a href="ButtonComponent.html#build">build</a></li></ul></li><li><a href="ButtonParameter.html">ButtonParameter</a></li><li><a href="Contacts.html">Contacts</a></li><li><a href="Currency.html">Currency</a></li><li><a href="DateTime.html">DateTime</a></li><li><a href="Document.html">Document</a></li><li><a href="Email.html">Email</a></li><li><a href="Footer.html">Footer</a></li><li><a href="Header.html">Header</a></li><li><a href="HeaderComponent.html">HeaderComponent</a></li><li><a href="Image.html">Image</a></li><li><a href="Interactive.html">Interactive</a></li><li><a href="Language.html">Language</a></li><li><a href="ListSection.html">ListSection</a></li><li><a href="Location.html">Location</a></li><li><a href="Media.html">Media</a></li><li><a href="Name.html">Name</a></li><li><a href="Organization.html">Organization</a></li><li><a href="Parameter.html">Parameter</a></li><li><a href="Phone.html">Phone</a></li><li><a href="Product.html">Product</a></li><li><a href="ProductSection.html">ProductSection</a></li><li><a href="Reaction.html">Reaction</a></li><li><a href="Request.html">Request</a></li><li><a href="Row.html">Row</a></li><li><a href="Sticker.html">Sticker</a></li><li><a href="Template.html">Template</a></li><li><a href="Text.html">Text</a></li><li><a href="Url.html">Url</a></li><li><a href="Video.html">Video</a></li><li><a href="WhatsAppAPI.html">WhatsAppAPI</a><ul class='methods'><li data-type='method'><a href="WhatsAppAPI.html#_authenicatedRequest">_authenicatedRequest</a></li><li data-type='method'><a href="WhatsAppAPI.html#createQR">createQR</a></li><li data-type='method'><a href="WhatsAppAPI.html#deleteMedia">deleteMedia</a></li><li data-type='method'><a href="WhatsAppAPI.html#deleteQR">deleteQR</a></li><li data-type='method'><a href="WhatsAppAPI.html#fetchMedia">fetchMedia</a></li><li data-type='method'><a href="WhatsAppAPI.html#logSentMessages">logSentMessages</a></li><li data-type='method'><a href="WhatsAppAPI.html#markAsRead">markAsRead</a></li><li data-type='method'><a href="WhatsAppAPI.html#retrieveMedia">retrieveMedia</a></li><li data-type='method'><a href="WhatsAppAPI.html#retrieveQR">retrieveQR</a></li><li data-type='method'><a href="WhatsAppAPI.html#sendMessage">sendMessage</a></li><li data-type='method'><a href="WhatsAppAPI.html#updateQR">updateQR</a></li><li data-type='method'><a href="WhatsAppAPI.html#uploadMedia">uploadMedia</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="Exports.html">Exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#get">get</a></li><li><a href="global.html#post">post</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">fetch.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { Contacts } = require("./messages/contacts");
const { Interactive } = require("./messages/interactive");
const { Audio, Document, Image, Sticker, Video } = require("./messages/media");
const Location = require("./messages/location");
const Reaction = require("./messages/reaction");
const { Template } = require("./messages/template");
const Text = require("./messages/text");

const req = require("./ponyfill").pickFetch();

/**
 * Request API object
 *
 * @property {String} messaging_product The messaging product (always "whatsapp")
 * @property {String} type The type of message
 * @property {String} to The user's phone number
 * @property {Object} [context] The message to reply to
 * @property {String} context.message_id The message id to reply to
 * @property {String} [text] The text object stringified
 * @property {String} [audio] The audio object stringified
 * @property {String} [document] The document object stringified
 * @property {String} [image] The image object stringified
 * @property {String} [sticker] The sticker object stringified
 * @property {String} [video] The video object stringified
 * @property {String} [location] The location object stringified
 * @property {String} [contacts] The contacts object stringified
 * @property {String} [interactive] The interactive object stringified
 * @property {String} [template] The template object stringified
 * @property {String} [reaction] The reaction object stringified
 */
class Request {
    /**
     * Create a Request object for the API
     *
     * @param {(Text|Audio|Document|Image|Sticker|Video|Location|Contacts|Interactive|Template|Reaction)} object The object to send
     * @param {String} to The user's phone number
     * @param {String} [context] The message_id to reply to
     */
    constructor(object, to, context) {
        let message = { ...object };
        this.messaging_product = "whatsapp";
        this.type = message._;
        delete message._;
        this.to = to;

        if (context) this.context = { message_id: context };

        // If the object contains its name as a property, it means it's an array, use it, else use the class
        // This horrible thing comes from Contacts, the only API element which must be an array instead of an object...
        this[this.type] = JSON.stringify(message[this.type] ?? message);
    }
}

/**
 * The sendMessage response object
 *
 * @package
 * @ignore
 * @typedef {Object} SendMessageResponse
 * @property {Promise&lt;Response|import("undici/types/fetch").Response>} promise The fetch promise
 * @property {Request} request The request sent to the server
 */

/**
 * Make a message post request to the API
 *
 * @package
 * @ignore
 * @param {String} token The API token
 * @param {String} v The API version
 * @param {String} phoneID The bot's phone id
 * @param {String} to The user's phone number
 * @param {(Text|Audio|Document|Image|Sticker|Video|Location|Contacts|Interactive|Template|Reaction)} object Each type of message requires a specific type of object, for example, the "image" type requires an url and optionally captions. Use the constructors for each specific type of message (contacts, interactive, location, media, template, text)
 * @param {String} context The message id to reply to
 * @returns {SendMessageResponse} An object with the sent request and the fetch promise
 */
function sendMessage(token, v, phoneID, to, object, context) {
    const request = new Request(object, to, context);

    // Make the post request
    const promise = req(`https://graph.facebook.com/${v}/${phoneID}/messages`, {
        method: "POST",
        headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify(request)
    });

    return { promise, request };
}

/**
 * Mark a message as read
 *
 * @package
 * @ignore
 * @param {String} token The API token
 * @param {String} v The API version
 * @param {String} phoneID The bot's phone id
 * @param {String} message_id The message id
 * @returns {Promise&lt;Response|import("undici/types/fetch").Response>} The fetch promise
 */
function readMessage(token, v, phoneID, message_id) {
    return req(`https://graph.facebook.com/${v}/${phoneID}/messages`, {
        method: "POST",
        headers: {
            Authorization: `Bearer ${token}`,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            messaging_product: "whatsapp",
            status: "read",
            message_id
        })
    });
}

/**
 * Generate a QR code for the bot
 *
 * @package
 * @ignore
 * @param {String} token The API token
 * @param {String} v The API version
 * @param {String} phoneID The bot's phone id
 * @param {String} message The default message in the QR code
 * @param {"png"|"svg"} format The image format of the QR code
 * @returns {Promise&lt;Response|import("undici/types/fetch").Response>} The fetch promise
 */
function makeQR(token, v, phoneID, message, format) {
    const params = {
        generate_qr_image: format,
        prefilled_message: message
    };

    return req(
        `https://graph.facebook.com/${v}/${phoneID}/message_qrdls?${new URLSearchParams(
            params
        )}`,
        {
            method: "POST",
            headers: {
                Authorization: `Bearer ${token}`
            }
        }
    );
}

/**
 * Get one or all the QR codes for the bot
 *
 * @package
 * @ignore
 * @param {String} token The API token
 * @param {String} v The API version
 * @param {String} phoneID The bot's phone id
 * @param {String} [id] The QR's id to get. If not specified, all the QR codes will be returned
 * @returns {Promise&lt;Response|import("undici/types/fetch").Response>} The fetch promise
 */
function getQR(token, v, phoneID, id) {
    return req(
        `https://graph.facebook.com/${v}/${phoneID}/message_qrdls/${id ?? ""}`,
        {
            headers: {
                Authorization: `Bearer ${token}`
            }
        }
    );
}

/**
 * Update a QR code for the bot
 *
 * @package
 * @ignore
 * @param {String} token The API token
 * @param {String} v The API version
 * @param {String} phoneID The bot's phone id
 * @param {String} id The QR's id to edit
 * @param {String} message The new message for the QR code
 * @returns {Promise&lt;Response|import("undici/types/fetch").Response>} The fetch promise
 */
function updateQR(token, v, phoneID, id, message) {
    const params = {
        prefilled_message: message
    };

    return req(
        `https://graph.facebook.com/${v}/${phoneID}/message_qrdls/${id}?${new URLSearchParams(
            params
        )}`,
        {
            method: "POST",
            headers: {
                Authorization: `Bearer ${token}`
            }
        }
    );
}

/**
 * Delete a QR code
 *
 * @package
 * @ignore
 * @param {String} token The API token
 * @param {String} v The API version
 * @param {String} phoneID The bot's phone id
 * @param {String} id The QR's id to delete
 * @returns {Promise&lt;Response|import("undici/types/fetch").Response>} The fetch promise
 */
function deleteQR(token, v, phoneID, id) {
    return req(
        `https://graph.facebook.com/${v}/${phoneID}/message_qrdls/${id}`,
        {
            method: "DELETE",
            headers: {
                Authorization: `Bearer ${token}`
            }
        }
    );
}

/**
 * Get a Media object
 *
 * @package
 * @ignore
 * @param {String} token The API token
 * @param {String} v The API version
 * @param {String} id The media's id
 * @returns {Promise&lt;Response|import("undici/types/fetch").Response>} The fetch promise
 */
function getMedia(token, v, id) {
    return req(`https://graph.facebook.com/${v}/${id}`, {
        headers: {
            Authorization: `Bearer ${token}`
        }
    });
}

/**
 * Upload a Media object
 *
 * @package
 * @ignore
 * @param {String} token The API token
 * @param {String} v The API version
 * @param {String} phoneID The bot's phone id
 * @param {(FormData|import("undici/types/formdata").FormData)} form The media to upload in form format (multipart/form-data)
 * @returns {Promise&lt;Response|import("undici/types/fetch").Response>} The fetch promise
 */
function uploadMedia(token, v, phoneID, form) {
    return req(
        `https://graph.facebook.com/${v}/${phoneID}/media?messaging_product=whatsapp`,
        {
            method: "POST",
            // @ts-ignore
            body: form,
            headers: {
                Authorization: `Bearer ${token}`,
                "Content-Type": "multipart/form-data"
            }
        }
    );
}

/**
 * Delete a Media
 *
 * @package
 * @ignore
 * @param {String} token The API token
 * @param {String} v The API version
 * @param {String} id The media's id
 * @returns {Promise&lt;Response|import("undici/types/fetch").Response>} The fetch promise
 */
function deleteMedia(token, v, id) {
    return req(`https://graph.facebook.com/${v}/${id}`, {
        method: "DELETE",
        headers: {
            Authorization: `Bearer ${token}`
        }
    });
}

/**
 * Make a GET request to any url with the authorization header.
 * Be sure where you are sending the request since it contains the API token.
 *
 * @package
 * @ignore
 * @param {String} token The API token
 * @param {(String|URL)} url The URL to fetch
 * @returns {Promise&lt;Response|import("undici/types/fetch").Response>} The fetch promise
 */
function authenticatedRequest(token, url) {
    return req(url, {
        headers: {
            Authorization: `Bearer ${token}`
        }
    });
}

module.exports = {
    sendMessage,
    readMessage,
    makeQR,
    getQR,
    updateQR,
    deleteQR,
    getMedia,
    uploadMedia,
    deleteMedia,
    authenticatedRequest,
    Request
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on Tue Oct 25 2022 02:50:53 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
